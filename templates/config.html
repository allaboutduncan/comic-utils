{% extends 'base.html' %}

{% block title %}CLU: Config Page{% endblock %}

{% block scripts %}
<script>
    function restartApp() {
        fetch('/restart', { method: 'POST' })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(error => console.error('Error:', error));
    }
    
    document.addEventListener("DOMContentLoaded", function () {
        const xmlCheckboxes = document.querySelectorAll(".xml-checkbox");

       xmlCheckboxes.forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                if (this.checked) {
                    xmlCheckboxes.forEach(cb => {
                        if (cb !== this) {
                            cb.checked = false;
                        }
                    });
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}

<div class="container-lg">
    <h2 class="mt-4">Configuration Settings</h2>
    <form method="POST" class="mt-4">
        
        <!-- Missing Issue Configuration -->
        <div class="container p-4 border rounded shadow-sm mb-4">
            <h4>Missing Issue Configuration</h4>
            <p class="text-muted">Update these settings to ignore terms or files when the app is performing a <strong>Missing Issue</strong> scan.</p>

            <div class="row">
                <div class="col-md-6">
                    <label for="ignored_terms" class="form-label">IGNORED TERMS:</label>
                    <input type="text" name="ignored_terms" id="ignored_terms" value="{{ ignored_terms }}" class="form-control">
                    <small class="form-text text-muted">
                        Enter words or terms to ignore while performing a Missing Issue search. Terms must be comma-separated.
                    </small>
                </div>

                <div class="col-md-6">
                    <label for="ignored_files" class="form-label">IGNORED FILES:</label>
                    <input type="text" name="ignored_files" id="ignored_files" value="{{ ignored_files }}" class="form-control">
                    <small class="form-text text-muted">
                        Enter comma-separated file names to ignore when checking for missing issues (e.g., cover.jpg, cvinfo).
                    </small>
                </div>
            </div>
        </div>

        <!-- ComicInfo XML editing Configuration -->
        <div class="container p-4 border rounded shadow-sm mb-4">
            <h4>ComicInfo.XML Update Settings</h4>
            <p class="text-muted">Enable/Disable features for updating or cleaning <code>ComicInfo.xml</code> files. This proecess runs on a single directory, extracts the <code>ComicInfo.xml</code> file, reads and makes updates and then recompresses the file.</p>

            <!-- Checkboxes for ComicInfo.xml options -->
            <div class="row">
                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="xmlYear" name="xmlYear" {% if xmlYear %}checked{% endif %}>
                        <label class="form-check-label" for="xmlYear">{% if xmlYear %}Disable{% else %}Enable{% endif %} Update Volume to First Issue Year</label>
                        <small class="form-text text-muted">
                            <br />Reads the alpha-numeric first file in the directory and attempts to extract the 4-digit year from the filename.
                        </small>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input xml-checkbox" type="checkbox" role="switch" id="xmlMarkdown" name="xmlMarkdown" {% if xmlMarkdown %}checked{% endif %}>
                        <label class="form-check-label" for="xmlMarkdown">{% if xmlMarkdown %}Disable{% else %}Enable{% endif %} Removing ALL Markdown Content from Comments</label>
                        <small class="form-text text-muted">
                            <br />If enabled, when the ComicInfo.xml update function is run, the <code>Comments</code> will have all headers, bold text and tables removed.
                        </small>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input xml-checkbox" type="checkbox" role="switch" id="xmlList" name="xmlList" {% if xmlList %}checked{% endif %}>
                        <label class="form-check-label" for="xmlList">{% if xmlList %}Disable{% else %}Enable{% endif %} Removing 'Covers & Creators' table from Comments</label>
                        <small class="form-text text-muted">
                            <br />If enabled, when the ComicInfo.xml update function is run, 'Covers & Creators' tables will be removed from the <code>Comments</code>.
                        </small>
                    </div>
                </div>

            </div>
        </div>

        <!-- Folder Monitoring Configuration -->
        <div class="container p-4 border rounded shadow-sm mb-4">
            <h4>Folder Monitoring</h4>
            <p class="text-muted">Configure the <code>Watched</code> and <code>Target</code> folders. Other monitoring features can be adjusted here as well.</p>

            <div class="row">
                <div class="col-md-6">
                    <label for="watch" class="form-label">WATCH:</label>
                    <input type="text" name="watch" id="watch" value="{{ watch }}" class="form-control">
                    <small class="form-text text-muted">
                        Enter the path to the directory to monitor for downloaded files.
                    </small>
                </div>

                <div class="col-md-6">
                    <label for="target" class="form-label">TARGET:</label>
                    <input type="text" name="target" id="target" value="{{ target }}" class="form-control">
                    <small class="form-text text-muted">
                        Enter the path where renamed files will be moved.
                    </small>
                </div>
            </div>

            <hr>

            <!-- Checkboxes for AutoConvert & Subdirectories -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="autoConvert" name="autoConvert" {% if autoConvert %}checked{% endif %}>
                        <label class="form-check-label" for="autoConvert">{% if autoConvert %}Disable{% else %}Enable{% endif %} Auto CBZ Conversion</label>
                        <small class="form-text text-muted">
                            <br />Enables auto-conversion of CBR/RAR files to CBZ in your Watch folder.
                        </small>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="readSubdirectories" name="readSubdirectories" {% if readSubdirectories %}checked{% endif %}>
                        <label class="form-check-label" for="readSubdirectories">{% if readSubdirectories %}Disable{% else %}Enable{% endif %} Processing Sub-Directories</label>
                        <small class="form-text text-muted">
                            <br />If enabled, the app will process files in sub-directories of your <code>{{ watch }}</code> folder.
                        </small>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="autoUnpack" name="autoUnpack" {% if autoUnpack %}checked{% endif %}>
                        <label class="form-check-label" for="autoUnpack">{% if autoUnpack %}Disable{% else %}Enable{% endif %} Auto ZIP Extraction</label>
                        <small class="form-text text-muted">
                            <br />When enabled, ZIP files placed in the Watch folder will automatically be unzipped.
                        </small>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="moveDirectory" name="moveDirectory" {% if moveDirectory %}checked{% endif %}>
                        <label class="form-check-label" for="moveDirectory">{% if moveDirectory %}Disable{% else %}Enable{% endif %} Move Sub-Directories</label>
                        <small class="form-text text-muted">
                            <br />If enabled, when processing files in your <code>{{ watch }}</code> folder, the sub-dirctories will be moved as well.
                        </small>
                    </div>
                </div>
            </div>

        </div>

        <!-- Ignored Extensions Configuration -->
        <div class="container p-4 border rounded shadow-sm mb-4">
            <h4>Ignored Extensions</h4>
            <p class="text-muted">Specify file extensions that should be ignored during folder monitoring.</p>

            <div class="row">
                <div class="col-md-12">
                    <label for="ignored_extensions" class="form-label">IGNORED EXTENSIONS:</label>
                    <input type="text" name="ignored_extensions" id="ignored_extensions" value="{{ ignored_extensions }}" class="form-control">
                    <small class="form-text text-muted">
                        Enter extensions to ignore when monitoring files (e.g., .tmp, .crdownload).
                    </small>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="mb-3 text-center">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-floppy"></i> Save
            </button>
        </div>
    </form>

    <!-- Restart Button -->
    <div class="container p-4 border rounded shadow-sm text-center">
        <h6>Restart Flask App</h6>
        <button onclick="restartApp()" class="btn btn-secondary">Restart App</button>
    </div>
</div>

{% endblock %}
